<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StockWatch Digest — {{ d.run_date }}</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 14px; color: #222; }
    h1 { color: #1a1a2e; }
    h2 { color: #16213e; border-bottom: 1px solid #ddd; padding-bottom: 4px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 16px; }
    th { background: #16213e; color: #fff; padding: 6px 10px; text-align: left; }
    td { padding: 5px 10px; border-bottom: 1px solid #eee; }
    .up { color: #2e7d32; font-weight: bold; }
    .down { color: #c62828; font-weight: bold; }
    .side { color: #f57c00; }
    .pct { font-family: monospace; }
  </style>
</head>
<body>
  <h1>StockWatch Digest — {{ d.run_date }}</h1>

  <h2>Market Summary</h2>
  <table>
    <tr><th>Metric</th><th>Value</th></tr>
    <tr><td>Tickers analysed</td><td>{{ d.total }}</td></tr>
    <tr><td>Uptrend</td><td class="up">{{ d.uptrend_count }} ({{ "%.0f"|format(d.uptrend_count / d.total * 100 if d.total else 0) }}%)</td></tr>
    <tr><td>Downtrend</td><td class="down">{{ d.downtrend_count }} ({{ "%.0f"|format(d.downtrend_count / d.total * 100 if d.total else 0) }}%)</td></tr>
    <tr><td>Sideways</td><td class="side">{{ d.sideways_count }} ({{ "%.0f"|format(d.sideways_count / d.total * 100 if d.total else 0) }}%)</td></tr>
    <tr><td>Avg trend strength</td><td>{{ d.avg_strength }}/100</td></tr>
  </table>

  <h2>Top Gainers (1-day)</h2>
  <table>
    <tr><th>Ticker</th><th>1-Day Return</th><th>Trend</th><th>Strength</th></tr>
    {% for r in d.top_gainers %}
    <tr>
      <td><strong>{{ r.ticker }}</strong></td>
      <td class="pct up">+{{ "%.2f"|format(r.return_1d * 100) }}%</td>
      <td>{{ r.trend }}</td>
      <td>{{ r.trend_strength }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No data</td></tr>
    {% endfor %}
  </table>

  <h2>Top Losers (1-day)</h2>
  <table>
    <tr><th>Ticker</th><th>1-Day Return</th><th>Trend</th><th>Strength</th></tr>
    {% for r in d.top_losers %}
    <tr>
      <td><strong>{{ r.ticker }}</strong></td>
      <td class="pct down">{{ "%.2f"|format(r.return_1d * 100) }}%</td>
      <td>{{ r.trend }}</td>
      <td>{{ r.trend_strength }}</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No data</td></tr>
    {% endfor %}
  </table>

  <h2>Strongest Uptrends</h2>
  <table>
    <tr><th>Ticker</th><th>Strength</th><th>RSI</th><th>20d Return</th></tr>
    {% for r in d.strongest_up %}
    <tr>
      <td><strong>{{ r.ticker }}</strong></td>
      <td class="up">{{ r.trend_strength }}</td>
      <td>{{ "%.1f"|format(r.rsi14) if r.rsi14 is not none else "—" }}</td>
      <td class="pct">{{ "+%.2f"|format(r.return_20d * 100) if r.return_20d is not none else "—" }}%</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No uptrends today</td></tr>
    {% endfor %}
  </table>

  <h2>Strongest Downtrends</h2>
  <table>
    <tr><th>Ticker</th><th>Strength</th><th>RSI</th><th>20d Return</th></tr>
    {% for r in d.strongest_down %}
    <tr>
      <td><strong>{{ r.ticker }}</strong></td>
      <td class="down">{{ r.trend_strength }}</td>
      <td>{{ "%.1f"|format(r.rsi14) if r.rsi14 is not none else "—" }}</td>
      <td class="pct">{{ "%.2f"|format(r.return_20d * 100) if r.return_20d is not none else "—" }}%</td>
    </tr>
    {% else %}
    <tr><td colspan="4">No downtrends today</td></tr>
    {% endfor %}
  </table>

  {% if d.volume_anomalies %}
  <h2>Volume Anomalies (2× avg)</h2>
  <table>
    <tr><th>Ticker</th><th>Trend</th><th>Strength</th><th>1d Return</th></tr>
    {% for r in d.volume_anomalies %}
    <tr>
      <td><strong>{{ r.ticker }}</strong></td>
      <td>{{ r.trend }}</td>
      <td>{{ r.trend_strength }}</td>
      <td class="pct">{{ "%.2f"|format(r.return_1d * 100) if r.return_1d is not none else "—" }}%</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}

  <hr>
  <p style="color:#888; font-size:11px;">Generated by StockWatch · Data via Yahoo Finance · Not financial advice.</p>
</body>
</html>
